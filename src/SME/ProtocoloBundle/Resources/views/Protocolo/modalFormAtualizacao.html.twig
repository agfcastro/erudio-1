<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Protocolo {{protocolo.protocolo}}</h4>
    </div>
    <div class="modal-body">
        <form id="formProtocolo">
            <table class="table table-striped table-hover">
                <tr>
                    <th>Requerente</th>
                    <td>{{protocolo.requerente.nome}}</td>
                </tr>
                <tr>
                    <th>Solicitação</th>
                    <td>{{protocolo.solicitacao.nome}}</td>
                </tr>
                <tr>
                    <th>Situação</th>
                    <td>
                        <select id="situacao" name="situacao" class="form-control" required="true">
                            {% for situacao in situacoes %}
                                {% if situacao.terminal %}
                                    <option {% if protocolo.situacao.id == situacao.id %}selected="true"{% endif %} class="terminal text-warning" value="{{situacao.id}}"> 
                                        {{situacao.nome}}
                                    </option>
                                {% else %}
                                    <option {% if protocolo.situacao.id == situacao.id %}selected="true"{% endif %} value="{{situacao.id}}">
                                        {{situacao.nome}}
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>Último Responsável</th>
                    <td>{{protocolo.responsavelAtual.nome}}</td>
                </tr>
                <tr>
                    <th>Data de Abertura</th>
                    <td>{{protocolo.dataCadastro|date('d/m/Y')}}</td>
                </tr>
                <tr>
                    <th>Última atualização</th>
                    <td>{% if protocolo.dataModificacao %} {{protocolo.dataModificacao|date('d/m/Y')}} {% endif %}</td>
                </tr>
                <tr>
                    <th>Data de Encerramento</th>
                    <td>{% if protocolo.dataEncerramento %} {{protocolo.dataEncerramento|date('d/m/Y')}} {% endif %}</td>
                </tr>
                <tr>
                    <th>Observação</th>
                    <td>
                        <textarea id="observacao" name="observacao" class="form-control form-control-static" rows="5">{{protocolo.observacao|trim}}</textarea>
                    </td>
                </tr>
            </table>
            <div class="row">
                <div class="col-lg-6">
                    <button id="btnAtualizar" type="button" class="btn btn-primary btn-block">Atualizar</button>
                </div>
                <div class="col-lg-6">
                    <button id="btnEncerrar" type="button" class="btn btn-block {% if not protocolo.situacao.terminal %}disabled{% else %}btn-danger{% endif %}">Encerrar</button>
                </div>
            </div>
            <input type="hidden" id="encerrar" name="encerrar" value="0" />
        </form>
    </div>
</div>

<script type="text/javascript">
    $("#btnAtualizar").click(function() {
        $("#encerrar").attr('value', 0);
        $.ajax({
            type: "POST",
            url: "{{url('protocolo_admin_atualizar', {'protocolo': protocolo.id})}}",
            data: $("#formProtocolo, #formPesquisaProtocolo").serialize(),
            success: function(retorno) {
                $("#divListaProtocolos").html(retorno);
            }
        });
        $("#modalDialog").modal('toggle');
    });
    
    $("#btnEncerrar").click(function() {
        if(confirm("Deseja realmente finalizar esta solicitação ?")) {
            $("#encerrar").attr('value', 1);
            $.ajax({
                type: "POST",
                url: "{{url('protocolo_admin_atualizar', {'protocolo': protocolo.id})}}",
                data: $("#formProtocolo, #formPesquisaProtocolo").serialize(),
                success: function(retorno) {
                    $("#divListaProtocolos").html(retorno);
                }
            });
        }
        $("#modalDialog").modal('toggle');
    });
    
    $("#situacao").change(function() {
        if($(this).find(":selected").hasClass("terminal")) {
            $("#btnEncerrar").addClass("btn-danger");
            $("#btnEncerrar").removeClass("disabled");
        } else {
            $("#btnEncerrar").addClass("disabled");
            $("#btnEncerrar").removeClass("btn-danger");
        }
    });
</script>
