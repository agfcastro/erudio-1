{% extends 'DGPBundle:Pessoa:cadastroPessoa.html.twig' %}

{% set activeTab = '5' %}

{% block headerTitle %}DGP > Pessoas > {{pessoa.nome}} > Vínculos{% endblock %}

{% block tabContent %}	
        <div class="row" style="margin-top: 10px; cursor: pointer;">
            <a href="{{path('dgp_pessoa_vinculo_cadastrar', {'pessoa': pessoa.id})}}" class="btn btn-primary">
                <span class="glyphicon glyphicon-plus"></span> Cadastrar
            </a>
        </div>
        <div class="row">
            <table class="table table-striped table-hover tableRoles">
                <thead>
                    <tr>
                        <th class="text-center">Cargo</th>
                        <th>Tipo</th>
                        <th>C.H.</th>
                        <th>Processo Admissional</th>
                        <th>Opções</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vinculo in vinculos %}
                        <tr>
                            <td>{{ vinculo.cargo.nome }}</td>
                            <td>{{ vinculo.tipoVinculo.nome }}</td>
                            <td>{{ vinculo.cargaHoraria }}</td>
                            <td>
                                {% if vinculo.inscricaoVinculacao %}
                                    {{ vinculo.inscricaoVinculacao.cargo.processo.nome }}
                                {% endif %}
                            </td>
                            <td>
                                <a class="lnkAlterar" href="{{ path('dgp_pessoa_vinculo_alterar', {'pessoa': pessoa.id, 'vinculo': vinculo.id }) }}">
                                    <span title="Alterar" class="glyphicon glyphicon-edit"></span>
                                </a> |
                                <span title="Alocações" class="glyphicon glyphicon-home listAllocation iconAllocation{{ vinculo.id }}" label="{{ vinculo.id }}" id="{{ path('dgp_vinculo_alocacao_listar', { 'vinculo': vinculo.id }) }}" style="cursor: pointer; width: 16px;" ></span>
                                <span title="Fechar Alocações" class="glyphicon glyphicon-remove-circle closeShowItem changeAllocation{{ vinculo.id }}" style="display: none; cursor: pointer; width: 16px;" ></span> |
                                {% if vinculo.tipoVinculo.id == constant('SME\\DGPBundle\\Entity\\TipoVinculo::EFETIVO') %}
                                    <a href="{{path('dgp_promocaoHorizontal_listar', {'vinculo': vinculo.id})}}">
                                        <span title="Promoções" class="glyphicon glyphicon-gift"></span>
                                    </a> |
                                {% endif %}
                                <a class="lnkDocumentos" href="{{path('dgp_vinculo_imprimirDocumentos', {'vinculo': vinculo.id})}}">
                                    <span title="Documentos" class="glyphicon glyphicon-print"></span>
                                </a> |
                                <a class="lnkExcluir" href="{{path('dgp_pessoa_vinculo_excluir', {'pessoa': pessoa.id, 'vinculo': vinculo.id }) }}">
                                    <span title="Excluir" class="glyphicon glyphicon-remove"></span>
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td style="background: white; display: none;" colspan=4 class="ajaxAllocation{{vinculo.id}} showAllocations">

                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td class="text-center" colspan="5">
                                <em>A pessoa não possui nenhum vínculo ativo com a Secretaria</em>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    
    <div id="modalDialog" class="modal fade" role="dialog">
        <div id="divModalDocumentos" class="modal-dialog" style="width: 80%;"></div>
    </div>
{% endblock %}

{% block javascript %}
    {{parent()}}
    <script type="text/javascript">
        
        $(document).ready(function (){
           $(".lnkDocumentos").click(function (ev){
               ev.preventDefault();
               $.ajax({
                   url: $(this).attr('href'),
                   type: 'GET',
                   success: function (data) {
                       $('#divModalDocumentos').html(data);
                   }
               });
               $('#modalDialog').modal("show");
           });          
        });
        
        $(".lnkExcluir").click(function(ev) {
            if(!confirm("Deseja realmente excluir o vínculo? (Use esta opção apenas para excluir cadastros incorretos)")) {
                ev.preventDefault();
            }
        });

        $(".listAllocation").click(function (){
            var selector = 'ajaxAllocation'+$(this).attr('label');
            var item = $(this).attr('label');
            var id = $(this).attr('id');

            $(".closeShowItem").hide();
            $(".listAllocation").show();

            $.ajax({
                url: id,
                type: 'GET',
                success: function (data)
                {
                    if (data !== "error") {
                        $(".showAllocations").html('').hide();
                        $(".iconAllocation"+item).hide();
                        $(".changeAllocation"+item).show();
                        $("."+selector).html(data).show();
                    } else {
                        $.bootstrapGrowl("O sistema não pôde mostrar as alocações, aguarde um pouco e tente novamente.", { type: 'danger', delay: 3000 });
                    }
                }
            });
        });

        $(".closeShowItem").click(function(){
            $(".showAllocations").html('').hide();
            $(".listAllocation").show();
            $(".closeShowItem").hide();
        });
    </script>
{% endblock %}