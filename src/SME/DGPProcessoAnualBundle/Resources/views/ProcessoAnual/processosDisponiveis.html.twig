{% extends 'DGPBundle:Servidor:index.html.twig' %}

{% block headerTitle %}Servidor > Processos Anuais{% endblock %}

{% block page %}
    <h3>Minhas Inscrições</h3>
    {% if inscricoes is empty %}
         <p>Nenhuma inscrição realizada para este ano</p>
    {% else %}
        <table class="table table-hover tableRoles">
            <thead>
                <tr>
                    <th>Cod.</th>
                    <th><i>Processo/Ano</i></th>
                    <th><i>Vínculo</i></th>
                    <th><i>Data de Cadastro</i></th>
                </tr>
            </thead>
            <tbody>
                {% for inscricao in inscricoes %}
                    <tr>
                        <td>{{ inscricao.id }}</td>
                        <td>{{ inscricao.processoAnual.nome }} - {{ inscricao.ano }}</td>
                        <td>{{ inscricao.vinculoServidor.cargo.nome }} - {{ inscricao.vinculoServidor.tipoVinculo.nome }} - {{ inscricao.vinculoServidor.cargaHoraria }}h</td>
                        <td>{{ inscricao.dataCadastro | date('d/m/Y') }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <hr />
    {% endif %}
    
    <h3>Processos Disponíveis</h3>
    {% if processos is empty %}
        <p>Não há nenhum processo em aberto no qual não esteja inscrito.</p>
    {% else %}
        <label for="vinculoInscricao">Vínculo Efetivo:</label>
        <select id="vinculoInscricao" style="margin-bottom: 2%;" class="form-control">
            <option>Selecione uma opção</option>
            {% for vinculo in vinculos %}
                <option value="{{ vinculo.id }}">{{ vinculo.cargo.nome }} - {{ vinculo.tipoVinculo.nome }} - {{ vinculo.cargaHoraria }}h</option>
            {% endfor %}
        </select>

        <div> 
            <table class="table table-striped table-hover tableRoles" style="width: 50%;">
                <thead>
                    <tr>
                        <th>Processo</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for processo in processos %}
                        <tr>
                            <td>{{ processo.nome }}</td>
                            <td>
                                <a class="btnInscrever btn btn-primary" style="float: right"
                                   href="{{ path('dgp_servidor_processoAnual_cadastrarInscricao', { processo: processo.id } ) }}">
                                    Inscrever-se
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
{% endblock %}

{% block javascript %}
    {{parent()}}
    <script type="text/javascript">
        $(".btnInscrever").click(function(ev){
            var url = $(this).attr('href');
            var val = $('#vinculoInscricao').val();

            if(val > 0) {
                $.ajax({
                    'url': url,
                    'type': 'POST',
                    'data': { vinculo: val },
                    'success': function (data){
                       location.reload(true);
                    }
                });
            } else {
                alert("Selecione um de seus vínculos acima para se inscrever no processo");
            }
            ev.preventDefault();
        });
    </script>
{% endblock %}