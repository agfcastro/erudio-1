{% extends 'DGPPromocaoBundle:Index:index.html.twig' %}

{% set activeTab = '1' %}

{% block tabContent %}
    <div class="row" id="formErrors">
        {{ erros | raw }}
    </div>
    
    {{ form_start(form) }}
        <div class="row">
            <div class="col-md-2">
                <label>Ano:</label>
                {{ form_widget(form.ano, { 'attr': {'class': 'form-control'} }) }}
            </div>
            <div class="col-md-2">
                <label>C.H.:</label>
                <span class="form-control" {% if promocao.cargaHorariaAcumulada >= 40 %} style="background: #DFF0D8; border: 1px solid #1abc9c;" {% endif %} >{{ promocao.cargaHorariaAcumulada }}</span>
            </div>
            <div class="col-md-2">
                <label>Nível Anterior:</label>
                {{ form_widget(form.nivelAnterior, { 'attr': {'class': 'form-control'} }) }}
            </div>
            <div class="col-md-2">
                <label>Nível Atual:</label>
                {{ form_widget(form.nivelAtual, { 'attr': {'class': 'form-control'} }) }}
            </div>
            <div class="col-md-4">
                <label>A Contar De:</label>
                {{ form_widget(form.dataInicio, { 'attr': {'class': 'form-control datepickerSME'} }) }}
            </div>
            <div class="col-md-4">
                <label>Status:</label>
                {{ form_widget(form.status, { 'attr': {'class': 'form-control'} }) }}
            </div>
            <div class="col-md-8">
                <label>Resposta:</label>
                {{ form_widget(form.resposta, { 'attr': {'class': 'form-control'} }) }}
            </div>
            <div class="col-md-6">
                <label>Observações:</label>
                {{ form_widget(form.observacao, { 'attr': {'class': 'form-control'} }) }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">{{ form_widget(form.btnSalvar, { 'attr': {'class': 'btn btn-primary'} }) }}</div>
        </div>
    {{ form_end(form) }}

    <div class="panel panel-default" style="margin-top: 1em;">
        <div class="panel-heading">Formações da S.M.E (Certificados Digitais)</div>
        <div class="panel-body">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="text-center">Nome</th>
                        <th class="text-center">Carga Horária</th>
                        <th class="text-center">Data de Conclusão</th>
                        <th class="text-center">Opções</th>
                    </tr>
                </thead>
                <tbody>
                    {% for formacao in promocao.formacoesInternas %}
                        <tr>
                            <td>{{ formacao.matricula.formacao.nome }}</td>
                            <td>{{ formacao.matricula.formacao.cargaHoraria }}</td>
                            <td>{{ formacao.matricula.formacao.dataTerminoFormacao | date('d/m/Y') }}</td>
                            <td class="text-center">
                                <a class="lnkExcluir" href="{{ path('dgp_promocaoHorizontal_formacaoInterna_excluir', { 'promocao': promocao.id, 'formacao': formacao.id }) }}">
                                    <span title="Excluir" class="glyphicon glyphicon-remove"></span>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td class="text-center" colspan="4"> <em>Não há formações da SME incluídas</em> </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>       
            {% if formacoesInternas is not empty  %}
                <form method="POST" action="{{ path('dgp_promocaoHorizontal_formacaoInterna_incluir', { 'promocao': promocao.id }) }}">
                    <div class="col-md-4">
                        <select name="matricula" id="matricula" class="form-control">
                            {% for matricula in formacoesInternas %}
                                <option value="{{ matricula.id }}">{{ matricula.formacao.nome }} ({{ matricula.formacao.cargaHoraria }}hr)</option>
                            {% endfor %}
                        </select>        
                    </div>
                    <div class="col-md-1"><button class="btn btn-primary">Incluir</button></div>
                </form>
            {% endif %}
        </div>
    </div>
                    
     <div class="panel panel-default" style="margin-top: 1em;">
        <div class="panel-heading">Formações Externas</div>
        <div class="panel-body">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="text-center">Nome</th>
                        <th class="text-center">Carga Horária</th>
                        <th class="text-center">Instituição</th>
                        <th class="text-center">Data de Conclusão</th>
                        <th class="text-center">Opções</th>
                    </tr>
                </thead>
                <tbody>
                    {% for formacao in promocao.formacoesExternas %}
                        <tr>
                            <td>{{ formacao.nome }}</td>
                            <td>{{ formacao.cargaHoraria }}</td>
                            <td>{{ formacao.instituicao }}</td>
                            <td>{{ formacao.dataConclusao | date('d/m/Y') }}</td>
                            <td class="text-center">
                                <a class="lnkExcluir" href="{{ path('dgp_promocaoHorizontal_formacaoExterna_excluir', { 'promocao': formacao.promocaoHorizontal.id, 'formacao': formacao.id }) }}">
                                    <span title="Excluir" class="glyphicon glyphicon-remove"></span>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td class="text-center" colspan="5"> <em>Não há formações externas cadastradas</em> </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{{ path('dgp_promocaoHorizontal_formacaoExterna_cadastrar', {'promocao': promocao.id}) }}" class="btnFormacaoExterna">
                <button style="margin-bottom: 15px;" class="btn btn-primary">Cadastrar Nova</button>
            </a>
        </div>
    </div>
                        
    <div id="modalDialog" class="modal fade" role="dialog">
        <div id="divModalFormacaoExterna" class="modal-dialog" style="width: 80%;"></div>
    </div>
{% endblock %}

{% block javascript %}
    {{parent()}}
    <script type="text/javascript">
        $('document').ready(function () {
            $(".btnFormacaoExterna").click(function (ev){
               ev.preventDefault();
               $.ajax({
                   url: $(this).attr('href'),
                   type: 'GET',
                   success: function (data) {
                       $('#divModalFormacaoExterna').html(data);
                   }
               });
               $('#modalDialog').modal("show");
               $('#modalDialog').on('hidden.bs.modal', function () {
                    window.location.assign("{{ path('dgp_promocaoHorizontal_alterar', {'vinculo': promocao.vinculo.id,'promocao': promocao.id}) }}");
               });
           });
        });
    </script>
{% endblock %}
