{% extends app.request.isXmlHttpRequest ? '::templateAjax.html.twig' : '::template.html.twig' %}

{% block css %}
    {{parent()}}
{% endblock %}

{% block headerTitle %}Question치rios - Respostas{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-md-12">
                <div class="row">
                    <div class="col-lg-12"><label for="QuestionarioForm_nome">Nome do question치rio: *</label></div>
                    <div class="col-lg-12" style="margin-top: 5px;">
                        <select name='quest' class='quest form-control'>
                            <option></option>
                            {% for questionario in questionarios %}
                                <option value='{{ questionario.id }}'>{{ questionario.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
        </div>
        <div class="col-md-12">
            <hr />
            <table class="table table-striped table-hover tableDGP">
                <thead>
                    <tr>
                        <th>Nome</td>
                        <th>Data da resposta</td>
                    </tr>
                </thead>
                <tbody class='respostas-box'>
                    <tr><td colspan="2" class="text-center">Nenhuma resposta cadastrada neste question치rio.</td></tr>
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{parent()}}
    <script type="text/javascript">
        $('document').ready(function (){
           $('.quest').change(function (){
               var val = $(this).val();
               $.ajax({
                   url: '{{ path('questionarios_busca_respostas') }}',
                   dataType: 'JSON',
                   type: 'post',
                   data: { 'questionario': val },
                   success: function (data){
                       var array = JSON.parse(data);
                       if (array.length > 0) {
                           var str = '';
                           for (var i=0; i<array.length; i++) {
                               str += '<tr><td><a href="/questionario/' + array[i].questionarioId + '/respostas/mostrar/' + array[i].idPessoa + '">' + array[i].nomePessoa + '</a></td>';
                               str += '<td>' + array[i].dataResposta + '</td></tr>';
                           }
                           $('.respostas-box').html(str);
                       } else {
                           $('.respostas-box').html('<tr><td colspan="3" class="text-center">Nenhuma resposta cadastrada neste question치rio.</td></tr>');
                       }
                   }
               });
           });
        });
    </script>
{% endblock %}
